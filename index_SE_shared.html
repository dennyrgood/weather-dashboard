<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            padding: 8px;
            overflow: hidden;
        }
        
        body.theme-amber {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #1c1917;
        }
        
        body.theme-blue {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e3a8a;
        }
        
        body.theme-gray {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            color: #111827;
        }
        
        body.theme-cream {
            background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%);
            color: #292524;
        }
        
        body.theme-green {
            background: #0d1b0d;
            color: #33ff33;
            font-family: 'Courier New', monospace;
        }
        
        body.theme-blackgreen {
            background: linear-gradient(135deg, #86efac 0%, #4ade80 100%);
            color: #000000;
        }
        
        body.theme-amberblack {
            background: #000000;
            color: #fbbf24;
        }
        
        body.theme-sunset {
            background: linear-gradient(135deg, #fed7aa 0%, #fb923c 100%);
            color: #7c2d12;
        }
        
        body.theme-ocean {
            background: linear-gradient(135deg, #7dd3fc 0%, #0ea5e9 100%);
            color: #0c4a6e;
        }
        
        body.theme-forest {
            background: linear-gradient(135deg, #d1fae5 0%, #86efac 100%);
            color: #14532d;
        }
        
        body.theme-lavender {
            background: linear-gradient(135deg, #e9d5ff 0%, #c4b5fd 100%);
            color: #581c87;
        }
        
        body.theme-rose {
            background: linear-gradient(135deg, #fecdd3 0%, #fda4af 100%);
            color: #881337;
        }
        
        body.theme-dark {
            background: #111827;
            color: #f3f4f6;
        }
        
        body.theme-arctic {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            color: #0c4a6e;
        }
        
        body.theme-sepia {
            background: linear-gradient(135deg, #f5e6d3 0%, #d6bcab 100%);
            color: #44403c;
        }
        
        .container {
            width: 100%;
            max-width: 100%;
            display: flex;
            flex-direction: column;
            height: 100vh;
            gap: 8px;
        }
        
        .time {
            font-size: 1.8em;
            font-weight: 300;
            text-align: center;
            margin: 0;
        }
        
        .date {
            font-size: 0.75em;
            text-align: center;
            opacity: 0.9;
            margin: 0;
        }
        
        .weather-row {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
            min-height: 0;
        }
        
        .card {
            border-radius: 15px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 0;
        }
        
        body.theme-amber .card {
            background: rgba(255, 255, 255, 0.8);
            color: #1c1917;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        
        body.theme-blue .card {
            background: rgba(255, 255, 255, 0.9);
            color: #1e3a8a;
            box-shadow: 0 4px 16px rgba(30, 58, 138, 0.1);
        }
        
        body.theme-gray .card {
            background: #ffffff;
            color: #111827;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }
        
        body.theme-cream .card {
            background: rgba(255, 255, 255, 0.7);
            color: #292524;
            border: 1px solid rgba(41, 37, 36, 0.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        body.theme-green .card {
            background: rgba(0, 20, 0, 0.6);
            color: #33ff33;
            border: 2px solid #33ff33;
            box-shadow: 0 0 20px rgba(51, 255, 51, 0.3), inset 0 0 20px rgba(51, 255, 51, 0.1);
            text-shadow: 0 0 5px rgba(51, 255, 51, 0.7);
        }
        
        body.theme-blackgreen .card {
            background: rgba(220, 252, 231, 0.9);
            color: #000000;
            border: 2px solid #166534;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        
        body.theme-amberblack .card {
            background: rgba(20, 20, 20, 0.95);
            color: #fbbf24;
            border: 2px solid #f59e0b;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.2);
        }
        
        body.theme-sunset .card {
            background: rgba(255, 255, 255, 0.85);
            color: #7c2d12;
            box-shadow: 0 4px 16px rgba(124, 45, 18, 0.15);
        }
        
        body.theme-ocean .card {
            background: rgba(255, 255, 255, 0.9);
            color: #0c4a6e;
            box-shadow: 0 4px 16px rgba(12, 74, 110, 0.15);
        }
        
        body.theme-forest .card {
            background: rgba(255, 255, 255, 0.85);
            color: #14532d;
            box-shadow: 0 4px 16px rgba(20, 83, 45, 0.15);
        }
        
        body.theme-lavender .card {
            background: rgba(255, 255, 255, 0.85);
            color: #581c87;
            box-shadow: 0 4px 16px rgba(88, 28, 135, 0.15);
        }
        
        body.theme-rose .card {
            background: rgba(255, 255, 255, 0.85);
            color: #881337;
            box-shadow: 0 4px 16px rgba(136, 19, 55, 0.15);
        }
        
        body.theme-dark .card {
            background: #1f2937;
            color: #f3f4f6;
            border: 1px solid #374151;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }
        
        body.theme-arctic .card {
            background: rgba(255, 255, 255, 0.9);
            color: #0c4a6e;
            box-shadow: 0 4px 16px rgba(12, 74, 110, 0.1);
        }
        
        body.theme-sepia .card {
            background: rgba(255, 248, 240, 0.9);
            color: #44403c;
            border: 1px solid rgba(214, 188, 171, 0.3);
            box-shadow: 0 4px 16px rgba(68, 64, 60, 0.1);
        }
        
        .card-title {
            font-size: 0.75em;
            margin-bottom: 6px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            font-weight: 700;
        }
        
        .weather-main {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex: 1;
            min-height: 0;
        }
        
        .main-left {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .main-right {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .temperature {
            font-size: 3em;
            font-weight: 700;
            line-height: 1;
        }
        
        .temperature-secondary {
            font-size: 1.2em;
            font-weight: 700;
            opacity: 0.7;
            line-height: 1;
            margin-top: 4px;
        }
        
        .feels-like {
            font-size: 0.8em;
            font-weight: 600;
            opacity: 0.85;
            margin-top: 8px;
        }
        
        .temp-unit {
            font-size: 0.4em;
            vertical-align: top;
            font-weight: 400;
            margin-left: 1px;
        }
        
        .weather-icon {
            font-size: 60px;
            line-height: 1;
        }
        
        .weather-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px 8px;
            font-size: 0.65em;
            font-weight: 600;
            margin-top: 8px;
        }
        
        .weather-details > div {
            line-height: 1.3;
        }
        
        body.theme-green .weather-details {
            border-color: rgba(51, 255, 51, 0.3);
        }
        
        body.theme-amberblack .weather-details {
            border-color: rgba(251, 191, 36, 0.3);
        }
        
        .loading {
            text-align: center;
            opacity: 0.7;
            font-size: 0.8em;
        }
        
        .error {
            color: #ef4444;
            text-align: center;
            font-size: 0.7em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div>
            <div class="time" id="time">--:--</div>
            <div class="date" id="date">Loading...</div>
        </div>
        
        <div class="weather-row">
            <div class="card">
                <div class="card-title">City 1</div>
                <div id="weather-city1" class="loading">Loading...</div>
            </div>
            
            <div class="card">
                <div class="card-title">City 2</div>
                <div id="weather-city2" class="loading">Loading...</div>
            </div>
            
            <div class="card" style="flex: 0 0 auto; min-height: auto;">
                <div id="currency-content" class="loading">Loading rate...</div>
            </div>
        </div>
    </div>

    <script src="shared-data.js"></script>
    <script>
        function getUrlParameter(name) {
            var results = new RegExp('[?&]' + name + '=([^&#]*)').exec(window.location.href);
            return results ? decodeURIComponent(results[1]) : null;
        }
        
        var theme = getUrlParameter('theme') || 'blue';
        document.body.className = 'theme-' + theme;
        
        function updateTime() {
            var now = new Date();
            var timeStr = SharedData.padZero(now.getHours()) + ':' + SharedData.padZero(now.getMinutes());
            
            var days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            var months = ['January', 'February', 'March', 'April', 'May', 'June', 
                          'July', 'August', 'September', 'October', 'November', 'December'];
            
            var dateStr = days[now.getDay()] + ', ' + months[now.getMonth()] + ' ' + now.getDate();
            
            document.getElementById('time').textContent = timeStr;
            document.getElementById('date').textContent = dateStr;
        }
        
        function renderWeather(elementId, data) {
            var riseTime = SharedData.padZero(data.today.sunrise.getHours()) + ':' + SharedData.padZero(data.today.sunrise.getMinutes());
            var setTime = SharedData.padZero(data.today.sunset.getHours()) + ':' + SharedData.padZero(data.today.sunset.getMinutes());
            
            var tomorrowLowF = data.forecast[0].lowF;
            var tomorrowHighF = data.forecast[0].highF;
            
            var html = 
                '<div class="weather-main">' +
                '<div class="main-left">' +
                '<div class="temperature">' + data.current.tempF + '<span class="temp-unit">°F</span></div>' +
                '<div class="temperature-secondary">' + data.current.tempC + '<span class="temp-unit">°C</span></div>' +
                '<div class="feels-like">Feels ' + data.current.feelsLikeF + '<span class="temp-unit">°F</span></div>' +
                '</div>' +
                '<div class="main-right">' +
                '<div class="weather-icon">' + data.current.icon + '</div>' +
                '</div>' +
                '</div>' +
                '<div class="weather-details">' +
                '<div>Low/Tom:<br>' + data.today.lowF + '°F / ' + tomorrowLowF + '°F</div>' +
                '<div>High/Tom:<br>' + data.today.highF + '°F / ' + tomorrowHighF + '°F</div>' +
                '<div>Rise/Set:<br>' + riseTime + ' / ' + setTime + '</div>' +
                '<div>Humidity/Wind:<br>' + data.current.humidity + '% / ' + data.current.windSpeed + ' mph</div>' +
                '</div>';
            
            document.getElementById(elementId).innerHTML = html;
        }
        
        function fetchWeatherForLocation(elementId, lat, lon) {
            SharedData.fetchWeather(lat, lon, function(error, data) {
                if (error) {
                    document.getElementById(elementId).innerHTML = '<div class="error">' + error.error + '</div>';
                } else {
                    renderWeather(elementId, data);
                }
            });
        }
        
        function fetchAllWeather() {
            var city1Lat = parseFloat(getUrlParameter('city1_lat')) || 52.3676;
            var city1Lon = parseFloat(getUrlParameter('city1_lon')) || 4.9041;
            var city1Name = getUrlParameter('city1_name') || 'Amsterdam';
            
            var city2Lat = parseFloat(getUrlParameter('city2_lat')) || 27.7609;
            var city2Lon = parseFloat(getUrlParameter('city2_lon')) || -15.5863;
            var city2Name = getUrlParameter('city2_name') || 'Maspalomas';
            
            var city1Card = document.getElementById('weather-city1').parentNode;
            var city1Title = city1Card.getElementsByClassName('card-title')[0];
            if (city1Title) city1Title.textContent = city1Name;
            
            var city2Card = document.getElementById('weather-city2').parentNode;
            var city2Title = city2Card.getElementsByClassName('card-title')[0];
            if (city2Title) city2Title.textContent = city2Name;
            
            fetchWeatherForLocation('weather-city1', city1Lat, city1Lon);
            fetchWeatherForLocation('weather-city2', city2Lat, city2Lon);
        }
        
        function renderCurrency(data) {
            var leftIcon = data.status === 'low' ? '✅ ' : '';
            var rightIcon = data.status === 'high' ? ' ❌' : '';
            
            var infoParts = [];
            if (data.details.oxr) infoParts.push('OXR $' + data.details.oxr.rate + ' (' + data.details.oxr.dateTime + ')');
            if (data.details.ecb) infoParts.push('ECB $' + data.details.ecb.rate + ' (' + data.details.ecb.date + ')');
            if (data.details.alt) infoParts.push('Alt $' + data.details.alt.rate + (data.details.alt.dateTime ? ' (' + data.details.alt.dateTime + ')' : ''));
            var infoLine = infoParts.join(' • ');
            
            document.getElementById('currency-content').innerHTML = 
                '<div class="card-title">' + leftIcon + 'EUR → USD - $' + data.rate + 
                (data.source ? ' (' + data.source + ')' : '') + rightIcon + '</div>' +
                '<div style="font-size: 0.6em; opacity: 0.7; margin-top: 2px; word-wrap: break-word; white-space: normal;">' + infoLine + '</div>';
        }
        
        function fetchCurrency() {
            var thresholds = {
                low: parseFloat(getUrlParameter('low')) || 1.1,
                high: parseFloat(getUrlParameter('high')) || 1.2
            };
            
            SharedData.fetchCurrency(thresholds, function(error, data) {
                if (error) {
                    document.getElementById('currency-content').innerHTML = '<div class="error">' + error.error + '</div>';
                } else {
                    renderCurrency(data);
                }
            });
        }
        
        updateTime();
        setInterval(updateTime, 1000);
        
        fetchAllWeather();
        fetchCurrency();
        
        setInterval(fetchAllWeather, 600000);
        setInterval(function() {
            if (SharedData.isInActiveWindow()) {
                fetchCurrency();
            }
        }, 3600000);
    </script>
</body>
</html>
